# 事件驱动架构

## 什么是事件驱动

事件驱动架构（EDA）的核心思想：系统中的组件通过"事件"来通信，而不是直接调用。

比喻：传统架构像打电话（直接对话），事件驱动像发朋友圈（发布事件，感兴趣的人自己看）。

## 核心概念

- 事件（Event）：已经发生的事实，如"订单已创建"
- 事件生产者：产生事件的服务
- 事件消费者：监听并处理事件的服务
- 事件总线：传递事件的通道（Kafka、RabbitMQ 等）

## 同步调用 vs 事件驱动

```
同步调用：
订单服务 → 调用库存服务 → 调用支付服务 → 调用通知服务
（串行，任何一步失败都影响整体）

事件驱动：
订单服务 → 发布"订单已创建"事件
  → 库存服务监听，扣减库存
  → 支付服务监听，发起支付
  → 通知服务监听，发送通知
（并行，互不影响）
```

## 事件溯源（Event Sourcing）

不存储当前状态，而是存储所有事件。当前状态通过回放事件得到。

```
事件1：账户创建，余额 0
事件2：存入 1000
事件3：取出 200
事件4：存入 500
→ 当前余额 = 0 + 1000 - 200 + 500 = 1300
```

好处：完整的审计日志、可以回到任意时间点的状态。

## 适用场景

- 微服务之间的异步通信
- 需要审计日志的系统
- 复杂业务流程编排
- 实时数据处理

> 事件驱动让系统更松耦合，但也增加了调试和追踪的难度。
