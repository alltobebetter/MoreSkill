# 消息队列是什么

## 核心概念

消息队列就是一个"传话筒"。A 服务把消息放进队列，B 服务从队列里取出来处理。A 和 B 不需要直接对话。

比喻：你去餐厅点餐，把订单放在窗口（队列），厨师从窗口取订单做菜。你不需要等厨师做完才能坐下。

## 为什么需要消息队列

### 1. 解耦

没有消息队列：用户注册 → 发邮件 → 发短信 → 初始化积分（串行，任何一步失败都影响注册）

有消息队列：用户注册 → 发一条消息 → 邮件服务、短信服务、积分服务各自消费（互不影响）

### 2. 异步

耗时操作不阻塞主流程。用户下单后立即返回"下单成功"，后续的库存扣减、物流通知异步处理。

### 3. 削峰

秒杀场景：瞬间 10 万请求涌入。直接打到数据库会崩。用消息队列缓冲，后端按自己的速度慢慢处理。

## 核心模型

### 点对点（Queue）

一条消息只被一个消费者处理。适合任务分发。

### 发布/订阅（Pub/Sub）

一条消息被所有订阅者接收。适合事件通知。

## 主流消息队列

| 产品 | 特点 | 适用场景 |
|------|------|---------|
| RabbitMQ | 功能全面，支持多种协议 | 中小规模，复杂路由 |
| Kafka | 高吞吐，持久化，分布式 | 大数据、日志、事件流 |
| RocketMQ | 阿里开源，事务消息 | 电商、金融 |
| Redis Streams | 轻量级，基于 Redis | 简单场景 |

## 需要注意的问题

- 消息丢失：生产者确认 + 持久化 + 消费者确认
- 重复消费：消费者要做幂等处理
- 消息顺序：大部分场景不需要严格顺序
- 消息积压：监控队列长度，及时扩容消费者

> 消息队列不是银弹，它增加了系统复杂度。只在确实需要解耦、异步、削峰时使用。
