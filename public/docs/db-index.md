# 数据库索引原理

## 什么是索引

索引就是数据库的"目录"。没有索引，查一条数据要从头到尾扫描整张表。有了索引，数据库可以直接定位到目标位置。

比喻：在一本 1000 页的书里找"Redis"这个词。没有索引，你要翻完 1000 页。有了索引（目录），直接翻到第 342 页。

## B+ 树索引

大多数数据库的默认索引结构是 B+ 树。

特点：
- 所有数据都在叶子节点，且叶子节点之间有链表连接
- 树的高度通常只有 3-4 层
- 即使有上亿条数据，查找也只需要 3-4 次磁盘 I/O

```
        [30, 60]              ← 根节点
       /    |    \
   [10,20] [40,50] [70,80]   ← 中间节点
   / | \   / | \   / | \
  叶子节点（存实际数据指针）   ← 叶子节点，互相链接
```

## 索引类型

| 类型 | 说明 | 适用场景 |
|------|------|---------|
| 主键索引 | 唯一且非空 | 每张表必须有 |
| 唯一索引 | 值不能重复 | 邮箱、手机号 |
| 普通索引 | 最基本的索引 | 常用查询字段 |
| 联合索引 | 多个字段组合 | 多条件查询 |
| 全文索引 | 文本搜索 | 文章内容搜索 |

## 联合索引与最左前缀

```sql
CREATE INDEX idx_abc ON users(a, b, c);

-- 能用到索引
WHERE a = 1
WHERE a = 1 AND b = 2
WHERE a = 1 AND b = 2 AND c = 3

-- 用不到索引
WHERE b = 2
WHERE c = 3
WHERE b = 2 AND c = 3
```

联合索引像电话簿：先按姓排序，姓相同再按名排序。你可以按"姓"查，按"姓+名"查，但不能只按"名"查。

## 索引的代价

- 占用额外存储空间
- 写入（INSERT/UPDATE/DELETE）变慢，因为要同时更新索引
- 索引太多反而影响性能

## 实用建议

1. WHERE、JOIN、ORDER BY 中频繁出现的字段建索引
2. 区分度高的字段优先（如 email），区分度低的不要单独建（如 gender）
3. 用 EXPLAIN 验证索引是否生效
4. 定期检查和清理无用索引

> 索引不是越多越好，而是要建在"刀刃"上。
